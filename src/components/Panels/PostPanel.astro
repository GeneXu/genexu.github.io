---
import { getCollection } from "astro:content";
import Panel from "./Panel.astro";
import PostList from "../PostList/PostList.astro";
import { deconstructSlug } from "../../i18n/utils";

const { class: className } = Astro.props;

const posts = (await getCollection("blog"))
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
	.slice(0, 3);

const decoratedPosts = posts.map((post) => {
	const { lang, slugWithoutLang } = deconstructSlug(post.slug);
	return {
		...post,
		params: {
			slug: slugWithoutLang,
			lang: lang,
		},
	};
});
---

<Panel class:list={[className]}>
	<h3 class="text-2xl mb-2">Recent Posts</h3>
	<PostList posts={decoratedPosts} />
	<a class="text-xs text-blue-400 hover:text-blue-500 hover:dark:text-blue-500" href="/blog">All Posts â†’</a>
</Panel>
